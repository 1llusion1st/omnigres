$schema: "https://raw.githubusercontent.com/omnigres/omnigres/master/pg_yregress/schema.json"
instance:
  config:
    shared_preload_libraries: */env/OMNI_SO

tests:

- name: load hooks in a transaction
  tests:
  - steps:
    - create extension omni_test cascade
    - query: select 1
      notices:
      - run_hook
  # But once we're out of the transaction, hooks should not apply
  - steps:
    - query: select 1
      notices: [ ]

- name: commit creating the extension
  query: create extension omni_test cascade
  commit: true

- name: the hook should stay
  query: select 1
  notices:
  - run_hook